
# Reconfigure key bindings
###########################

set -g prefix C-t
unbind C-b

bind t send-prefix
# bind C-t last-window

# Not sure what this does yet
set-option -gw xterm-keys on

bind-key C-M-t send-prefix

unbind %
# bind | split-window -h
# bind - split-window -v

set -ga terminal-overrides ',*:Tc'

# Smart pane switching with awareness of vim splits
bind -n C-k run-shell 'tmux-vim-select-pane.rb -U'
bind -n C-j run-shell 'tmux-vim-select-pane.rb -D'
bind -n C-h run-shell 'tmux-vim-select-pane.rb -L'
bind -n C-l run-shell 'tmux-vim-select-pane.rb -R'
bind -n C-\ run-shell 'tmux-vim-select-pane.rb -l'

bind -n S-C-n next-window
bind -n S-C-p previous-window

# Bring back clear screen under tmux prefix
bind-key ^l send-keys C-l

bind Enter copy-mode

bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-selection
bind-key -T copy-mode-vi r send-keys -X rectangle-toggle

# Plugins
##########

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-copycat'
set -g @plugin 'tmux-plugins/tmux-pain-control'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'tmux-plugins/tmux-battery'
# set -g @plugin 'mshkrebtan/base16-tmux'

# Settings
###########

set-environment -gu RBENV_VERSION

set-option -g set-clipboard on

set-window-option -g pane-base-index 1
set-window-option -g base-index 1

setw -g main-pane-height 16

# The status line is more like a shell
setw -g mode-keys vi

setw -g xterm-keys on

set-option -g -q mouse on

set -g set-titles on
set -g set-titles-string '#S'

setw -g mode-bg colour61

bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"
bind -n WheelDownPane select-pane -t= \; send-keys -M

# Status bar
#############

# Colors:
# green 150
# red 174
# yellow 179
# purple 146
# blue 61 # 82/AA/FF
#
# grays: 235, 238, 236, 249

set -g status-bg colour235
set -g status-fg colour245

set -g message-fg colour232
set -g message-bg colour243

set-window-option -g pane-border-style fg=colour61
set-window-option -g pane-active-border-style fg=colour61

# Temp, colour61 is not working for the border fg
# set-window-option -g pane-border-style fg=white #,bg=colour61
# set-window-option -g pane-active-border-style fg=white #,bg=colour61

set-window-option -g monitor-activity on
set -g visual-activity off
set -g visual-bell on

# set -g status-bg default
# set-window-option -g window-status-attr none


# set-window-option -g window-status-activity-fg colour088
# set-window-option -g window-status-activity-bg colour235
set-window-option -g window-status-activity-fg colour251
set-window-option -g window-status-activity-bg colour235
set-window-option -g window-status-activity-attr none

set-window-option -g window-status-bg colour235
set-window-option -g window-status-fg colour245

# set-window-option -g window-status-current-bg default
set-window-option -g window-status-current-fg colour179
set-window-option -g window-status-current-attr underscore



# BG color is specified here because guard-tmux sets the bgcolor, so
# we're just letting it set the last few characters there
set-window-option -g status-left-bg colour235
set-window-option -g status-left-fg colour235
set-window-option -g status-left-length 32
set -g @prefix_highlight_fg 'colour61'
set -g @prefix_highlight_bg 'default'
set -g @prefix_highlight_empty_attr 'fg=colour61'
set -g @prefix_highlight_empty_prompt ' : '
set -g @prefix_highlight_prefix_prompt '*'
set -g @prefix_highlight_show_copy_mode 'on'
set -g @prefix_highlight_copy_prompt 'c'
set -g @prefix_highlight_copy_mode_attr 'fg=colour179,bg=default' # default is 'fg=default,bg=yellow'
set-window-option -g status-left '#[fg=colour235]#[bg=colour61] #S #[bg=default,fg=colour61]#{prefix_highlight}#[fg=default,bg=colour235] '
# set-window-option -g status-left '#[fg=colour235]#[bg=#82AAFF] #S #[bg=default,fg=colour61]#{prefix_highlight}#[fg=default,bg=colour235] '
#  

set -g status-bg colour235
set -g status-fg colour245

set-window-option -g status-right-length 96
# set-window-option -g status-right "#[fg=colour238]#[fg=default,bg=colour238] #{cpu_icon} #{cpu_percentage} #{battery_icon_status} #{battery_icon_charge} #{battery_percentage} #[fg=colour249]#[fg=colour235,bg=colour249] #(date '+%Y-%m-%d %H:%M') #(~/Dropbox/dotfiles/bin/pomodoro time)"
set-window-option -g status-right "#[fg=colour238]#[fg=default,bg=colour238] #{battery_icon_status} #{battery_icon_charge} #[fg=colour249]#[fg=colour235,bg=colour249] #(date '+%Y-%m-%d %H:%M') #(~/Dropbox/dotfiles/bin/pomodoro time)"

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
